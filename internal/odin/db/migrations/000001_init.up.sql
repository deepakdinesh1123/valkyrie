create table job_groups (
    id int primary key generated by default as identity,
    name text not null unique,
    created_at timestamptz not null default now()
);

create table job_types (
	id int primary key generated by default as identity,
	name text not null unique,
    created_at timestamptz not null default now()
);

create table workers (
    id int primary key,
    name text not null unique,
    created_at timestamptz not null default now()
);

create sequence workers_id_seq as int cycle owned by workers.id;
alter table workers alter column id set default nextval('workers_id_seq');

create sequence jobs_id_seq as bigint;

create table jobs (
    id bigint primary key default nextval('jobs_id_seq'),
    inserted_at timestamptz not null default now(),
    -- group_id int not null, will be added later
    -- type_id int not null, will be added later
    worker_id int references workers on delete set null,
    script text not null,
    script_path text not null,
    args varchar(1024),
    flake text not null,
    language text not null,
    completed bool not null default false,
    running bool not null default false
);

create sequence job_runs_id_seq as bigint;

create table job_runs (
    id bigint primary key default nextval('job_runs_id_seq'),
    job_id bigint not null,
    worker_id int not null references workers on delete set null,
    created_at timestamptz not null,
    started_at timestamptz not null,
    finished_at timestamptz not null,
    -- group_id int not null,
    -- type_id int not null,
    script text not null,
    flake text not null,
    args varchar(1024),
    logs text not null
);