name: "NSJail"

mode: ONCE
hostname: "NSJail"
log_level: ERROR

disable_rl: true

mount_proc: false

cwd: "/tmp/nsjail/"

clone_newnet: true
clone_newuser: true
clone_newns: true
clone_newpid: true
clone_newipc: true
clone_newuts: true
clone_newcgroup: true

uidmap {
	inside_id: "2048"
	outside_id: ""
	count: 1
}

gidmap {
	inside_id: "2048"
	outside_id: ""
	count: 1
}

keep_caps: false
keep_env: false

mount {
  src: "/bin"
  dst: "/bin"
  is_bind: true
  rw: false
}

mount {
  src: "/lib"
  dst: "/lib"
  rw: false
  is_bind: true
}

mount {
  src: "/sys/fs"
  dst: "/sys/fs"
  is_bind: true
  rw: false
}

mount {
  src: "/lib64"
  dst: "/lib64"
  is_bind: true
  rw: false
  mandatory: false
}


mount {
  src: "/usr"
  dst: "/usr"
  is_bind: true
  rw: false
}

mount {
	src: "/dev/null"
	dst: "/dev/null"
	is_bind: true
	rw: false
}

mount {
	dst: "/tmp"
	fstype: "tmpfs"
	rw: true
    options: "size=500000000"
}

mount {
	dst: "/proc"
	fstype: "proc"
	rw: false
}

mount {
  src: "/nix"
  dst: "/nix"
  rw: false
  is_bind: true
}

iface_no_lo: true

mount {
	src: "{{ .FileSource }}"
	dst: "/tmp/nsjail/"
  is_bind: true
  rw: false
}

exec_bin {
	path: "/bin/bash"
	arg: "/tmp/nsjail/nsexec.sh"
}

